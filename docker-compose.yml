nginx:
  container_name: nginx
  image: jwilder/nginx-proxy
  ports:
    - "80:80"
  volumes:
    - /var/run/docker.sock:/tmp/docker.sock:ro
  environment:
    - DEFAULT_HOST=api.local

api:
  container_name: api
  build: ./
  ports:
    - "3000:3000"
  volumes:
    - ./api:/api
  environment:
    - MYSQL_DATABASE=mydb
    - MYSQL_HOST=mysql
    - MYSQL_PASSWORD=password
    - MYSQL_USER=root
    - PORT=3000
    - VIRTUAL_HOST=api.local
  links:
    - mysql

mysql:
  container_name: mysql
  image: mysql:5.7.12
  expose:
    - 3306
  ports:
    - "3306:3306"
  environment:
    MYSQL_ROOT_PASSWORD: password

migrations:
  container_name: migrations
  image: mysql:5.7.12
  volumes:
    - ./migrations:/migrations
  command: sh -c 'mysql -h mysql -u root -ppassword mydb < /migrations/migrations.sql'
  links:
    - mysql
